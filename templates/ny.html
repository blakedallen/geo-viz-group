<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Sea Level Rise</title>
<script src="https://d3js.org/d3.v6.js"></script>
<script src="https://unpkg.com/d3-simple-slider"></script>

<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>

<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Goldman&display=swap" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/style.css">
<link rel="stylesheet" type="text/css" href="slider.css">

</head>
<body>

<!-- background: linear-gradient(to right, #fca107, #7f3121); -->
<div id="map" class="map"></div>

<div id="nav" class="cnavbar">
  <a href="/ny">New York</a>
  <a href="/seattle">Seattle</a>
  <a href="/hawaii">Maui</a>
  <a href="/sf">San Francisco</a>
</div>


<div id="control_panel" class="control_panel" >

        <h2>Sea Rise: <span id="numMeters">0</span> Meters | <span id="numFeet">0</span> Feet</h2>
        <input id="sea_level" class="seaSlider" type="range" min="0" max="80" step="1" value="0" />
        <button
          id="hideButton"
          onclick="expandPanel()"
        >Expand + </button>

        </br>
        </br>

        <button onclick="displayWidget(1)">Widget 1</button>
        <button onclick="displayWidget(2)">Widget 2</button>
        <button onclick="displayWidget(3)">Widget 3</button>
        <button onclick="displayWidget(4)">Widget 4</button>
          <div class="bar"></div>
          <div id="chart1">
            <h2> NOAA projected Sea Level Rise by 2200</h2>
            <h3> Carbon Emissions </h3>
            <select id="selectButton"></select>
          </div>

          <div id="chart2">
          <!-- escavic -->
          <div class="container">
                  <h3> Years: <span id="chart2yearsText">0</span></h3>
                  <input id="chart2years" class="seaSlider" type="range" min="0" max="2000" step="1" value="0" />
          <h12>Total CO2 Emissions(gt): <span id="COO2text">0</span></h2>
              <h2>üöó Cars Per Year(M): <span id="slider1textmin">0</span> = üè≠ CO2 (gt): <span id="slider1textemission">0</span></h2>
              <div id="slider1" class="slider"></div>
              <h2>‚úàÔ∏è Airplane Miles Per Year(M): <span id="slider2textmin">0</span> = üè≠ CO2 (gt): <span id="slider2textemission">0</span></h2>
              <div id="slider2" class="slider"></div>
              <h2>üçî Burgers Per Year(M): <span id="slider3textmin">0</span> = üè≠ CO2 (gt): <span id="slider3textemission">0</span></h2>
              <div id="slider3" class="slider"></div>
              <h2>üå≤ Trees Per Year(K): <span id="slider4textmin">0</span> = üè≠ CO2 (gt): <span id="slider4textemission">0</span></h2>
              <div id="slider4" class="slider"></div>
              <h2>‚òÄÔ∏è Solar Panels Per Year(K): <span id="slider5textmin">0</span> = üè≠ CO2 (gt): <span id="slider5textemission">0</span></h2>
              <div id="slider5" class="slider"></div>
          </div>

        </div>

        <div id="chart3">
            <div id="main-container" class="clearfix">
                  <h3> Years: <span id="chart3yearsText">0</span></h3>
                  <input id="chart3years" class="seaSlider" type="range" min="0" max="2000" step="1" value="0" />
                <div id="slider">
                    <h1>Pollutions by Industry Sector</h1>
                    <p>If that industry is gone..</p>
                </div>
                <div id="pie"></div>
            </div>
        </div>

    <div id="chart4">
      <h3> Year: <span id="chart4yearsText">2018</span></h3>
      <input id="chart4years" class="seaSlider" type="range" min="2018" max="2200" step="1" value="2018">
      <h2> CO2 Emissions by Country (gt) in 2018 </h2>
      <div align = center> Change in CO2 Emissions(gt): <output class="output" id="ttl"></output></div>
      <div></div>
      <div id="sliderdiv">
          <form id="sliderForm">
              <label for slider 1> China </label><br>
              <input class="yslider" id="yslider1" type="range" min="0" max="20" step="1" value="10.1"/>
              <br>
              <label for slider 3> Europe </label><br>
              <input class="yslider" id="yslider3" type="range" min="0" max="20" step="1" value="5.6"/>
              <br>
              <label for slider 4> United States </label><br>
              <input class="yslider" id="yslider4" type="range" min="0" max="20" step="1" value="5.4"/>
              <br>
              <label for slider 5> India </label><br>
              <input class="yslider" id="yslider5" type="range" min="0" max="20" step="1" value="2.66"/>
              <br>
              <label for slider 6> Russia </label><br>
              <input class="yslider" id="yslider6" type="range" min="0" max="20" step="1" value="1.7"/>
              <br>
              <label for slider 7> Japan </label><br>
              <input class="yslider" id="yslider7" type="range" min="0" max="20" step="1" value="1.2"/>
              <br>
              <label for slider 2> Rest of the World </label><br>
              <input class="yslider" id="yslider2" type="range" min="0" max="20" step="1" value="9.9"/>
              <br>
              <input type="button" onclick="resetFunction()" value="Reset">
          </form>
      </div>
      <div class="spacer"></div>
   </div>
</div>

<script>

//global variable, wait until loaded
var MASKS_LOADED = false;

//expand or hide control panel widgets
var hidden = true;
expandPanel = function() {
    var div = document.getElementById("control_panel");
    var button = document.getElementById("hideButton");
    if (hidden === false){
      hidden = true;
      div.style.height = "110px";
      button.innerText = "Expand +"
    } else{
      hidden = false;
      div.style.height = "900px";
      button.innerText = "Hide -"
    }
};

//initially set all charts as invisible (except 1)
var c1 = document.getElementById("chart1");
var c2 = document.getElementById("chart2");
var c3 = document.getElementById("chart3");
var c4 = document.getElementById("chart4");

c2.style.display = "none";
c3.style.display = "none";
c4.style.display = "none";


//display / switch which widget is visible
displayWidget = function(x){

  c1.style.display = "none";
  c2.style.display = "none";
  c3.style.display = "none";
  c4.style.display = "none";

  switch(x) {
  case 1:
    c1.style.display = "block";
    break;
  case 2:
    c2.style.display = "block";
    break;
  case 3:
    c3.style.display = "block";
    break;
  case 4:
    c4.style.display = "block";
    break;
  default:
    // code block
    break;
  }
};


//MAPBOX SETUP
	mapboxgl.accessToken = 'pk.eyJ1IjoiZXNjYWRhd2ciLCJhIjoiY2tmdmdrZGhkMTYzZDJ6czMyNWo0eWZmNCJ9.XAG-cdhWcLN2IEFAP6bCbg';
var map = new mapboxgl.Map({
container: 'map', // container id
//style: 'mapbox://styles/mapbox/streets-v11', // style URL
style: 'mapbox://styles/mapbox/satellite-streets-v11',
center: [-73.99, 40.74], // starting position [lng, lat]
// center: [-73.905, 40.775], // starting position [lng, lat]
zoom: 11.5, // starting zoom
pitch: 45
});


//SETUP MASKS VIA COORDINATES
//-122.44 47.51 -122.24 47.71
// coordinates = [
//   [-122.44, 47.71], //top_left
//   [-122.24, 47.71], //top_right
//   [-122.24, 47.51], //bottom_right
//   [-122.44, 47.51], //bottom_left
// ];

// -74.15 40.65 -73.66 40.90
coordinates = [
    [-74.15, 40.90],
    [-73.66, 40.90],
    [-73.66, 40.65],
    [-74.15, 40.65],
];


//stretch our image
// var t_lng = 0.0335; //stretches left and right
// var t_lat = 0.032; //stretches up and down

var t_lng = 0.081; //stretches left and right
var t_lat = 0.186; //stretches up and down


//translate top_left
coordinates[0][0] -= t_lng;
coordinates[0][1] += t_lat;

//translate top right
coordinates[1][0] += t_lng;
coordinates[1][1] += t_lat;

//translate bottom right
coordinates[2][0] += t_lng;
coordinates[2][1] -= t_lat;

//translate bottom left
coordinates[3][0] -= t_lng;
coordinates[3][1] -= t_lat;

//move left
var move_left = 0.004;
coordinates[0][0] -= move_left;
coordinates[1][0] -= move_left;
coordinates[2][0] -= move_left;
coordinates[3][0] -= move_left;

//move down
var move_down = 0.0001;
coordinates[0][1] -= move_down;
coordinates[1][1] -= move_down;
coordinates[2][1] -= move_down;
coordinates[3][1] -= move_down;


//generate our dataset
//TODO: load our dataset from json
masks = [];
for (var i = 0; i < 80; i += 1){
  var istr = i.toString();
  var d = {
    source:"source_"+istr,
    id:"image_"+istr,
    url:"/masks/ny_"+istr+".png",
    coordinates: coordinates,
  }
  masks.push(d);
}

map.on('load', function () {

  //add each of our masks
  for (var i = 0; i < masks.length; i++){
    var d = masks[i];

    //add images
    map.addSource(d["source"], {
    "type": "image",
    "url": d["url"],
    "coordinates": d["coordinates"],
    });

    map.addLayer({
    "id": d["id"],
    "source": d["source"],
    "type": "raster",
    "layout":{
      "visibility":"none",
    },
    "paint": {
      "raster-opacity": 0.5
      }
    });
  }
  MASKS_LOADED = true;


  var first_mask_id = masks[0]["id"];

  var prev_idg = first_mask_id;
  //set our initial layer as visible
  //map.setLayoutProperty(prev_idg, 'visibility', 'visible');

  document
    .getElementById('sea_level')
    .addEventListener('input', function (e) {
      var meters = parseInt(e.target.value, 10);
      var numMeters = document.getElementById("numMeters");
      numMeters.textContent = meters;
      var numFeet = document.getElementById("numFeet");
      var feet = meters * 3.281; //approximate conversion from
      numFeet.textContent = feet.toFixed(1);

      map.setLayoutProperty(prev_idg, 'visibility', 'none');
      if (meters > 0){
        meters -= 1;
        var idg = "image_"+meters.toString();
        //console.log(idg);
        map.setLayoutProperty(idg, 'visibility', 'visible');
        prev_idg = idg;
      }

    });


  // contours to map
  map.addSource('contours', {
    type: 'vector',
    url: 'mapbox://mapbox.mapbox-terrain-v2'
  });
  map.addLayer({
    'id': 'contours',
    'type': 'line',
    'source': 'contours',
    'source-layer': 'contour',
    'layout': {
    // make layer visible by default
      'visibility': 'visible',
      'line-join': 'round',
      'line-cap': 'round'
    },
    'paint': {
      'line-color': '#877b59',
      'line-width': 1
    }
  });

});

</script>

<script type="text/javascript" src="/js/chart1.js" ></script>
<script type="text/javascript" src="/js/chart2.js" ></script>
<script type="text/javascript" src="/js/chart3.js" ></script>
<script type="text/javascript" src="/js/chart4.js" ></script>
</body>
</html>
